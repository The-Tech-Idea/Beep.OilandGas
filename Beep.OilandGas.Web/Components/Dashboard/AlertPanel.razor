@using MudBlazor

<MudCard Elevation="@Elevation" Class="@($"alert-panel {Class}")">
    <MudCardContent>
        <MudStack Spacing="3">
            <MudStack Row="true" AlignItems="AlignItems.Center" Justify="Justify.SpaceBetween">
                <MudText Typo="Typo.h6">@Title</MudText>
                @if (ShowRefresh)
                {
                    <MudIconButton Icon="@Icons.Material.Filled.Refresh" 
                                  Size="Size.Small"
                                  OnClick="@RefreshAlerts" />
                }
            </MudStack>
            
            @if (_isLoading)
            {
                <MudProgressLinear Indeterminate="true" />
            }
            else if (_alerts.Any())
            {
                <MudList Dense="true">
                    @foreach (var alert in _alerts)
                    {
                        <MudListItem>
                            <MudAlert Severity="@alert.Severity" 
                                     Dense="true"
                                     Class="mb-2">
                                <MudStack Spacing="1">
                                    <MudStack Row="true" AlignItems="AlignItems.Center" Justify="Justify.SpaceBetween">
                                        <MudText Typo="Typo.body2" Style="font-weight: 600;">@alert.Title</MudText>
                                        <MudChip Size="Size.Small" Color="@GetChipColor(alert.Severity)">
                                            @alert.Severity.ToString()
                                        </MudChip>
                                    </MudStack>
                                    <MudText Typo="Typo.body2">@alert.Message</MudText>
                                    @if (alert.Timestamp.HasValue)
                                    {
                                        <MudText Typo="Typo.caption" Color="Color.Secondary">
                                            @alert.Timestamp.Value.ToString("g")
                                        </MudText>
                                    }
                                    @if (!string.IsNullOrEmpty(alert.ActionText) && alert.OnAction.HasDelegate)
                                    {
                                        <MudButton Variant="Variant.Text" 
                                                  Size="Size.Small"
                                                  Color="Color.Primary"
                                                  OnClick="@(() => alert.OnAction.InvokeAsync())">
                                            @alert.ActionText
                                        </MudButton>
                                    }
                                </MudStack>
                            </MudAlert>
                        </MudListItem>
                    }
                </MudList>
            }
            else
            {
                <MudText Typo="Typo.body2" Color="Color.Secondary" Align="Align.Center">
                    No alerts at this time
                </MudText>
            }
        </MudStack>
    </MudCardContent>
</MudCard>

@code {
    [Parameter] public string Title { get; set; } = "Alerts";
    [Parameter] public List<AlertItem> Alerts { get; set; } = new();
    [Parameter] public bool ShowRefresh { get; set; } = true;
    [Parameter] public int Elevation { get; set; } = 2;
    [Parameter] public string? Class { get; set; }
    [Parameter] public EventCallback OnRefresh { get; set; }

    private List<AlertItem> _alerts = new();
    private bool _isLoading = false;

    protected override void OnParametersSet()
    {
        _alerts = Alerts;
    }

    private async Task RefreshAlerts()
    {
        _isLoading = true;
        StateHasChanged();
        
        await OnRefresh.InvokeAsync();
        
        _isLoading = false;
        StateHasChanged();
    }

    private Color GetChipColor(Severity severity)
    {
        return severity switch
        {
            Severity.Error => Color.Error,
            Severity.Warning => Color.Warning,
            Severity.Info => Color.Info,
            Severity.Success => Color.Success,
            _ => Color.Default
        };
    }

    public class AlertItem
    {
        public string Title { get; set; } = string.Empty;
        public string Message { get; set; } = string.Empty;
        public Severity Severity { get; set; } = Severity.Info;
        public DateTime? Timestamp { get; set; }
        public string? ActionText { get; set; }
        public EventCallback OnAction { get; set; }
    }
}

<style>
    .alert-panel {
        height: 100%;
    }
</style>

