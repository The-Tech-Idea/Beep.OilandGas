@using MudBlazor

<MudCard Elevation="@Elevation" Class="@($"field-map {Class}")">
    <MudCardContent>
        <MudStack Spacing="3">
            <MudStack Row="true" AlignItems="AlignItems.Center" Justify="Justify.SpaceBetween">
                <MudText Typo="Typo.h6">@Title</MudText>
                @if (ShowControls)
                {
                    <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2">
                        <MudSelect T="string" 
                                  @bind-Value="@_mapType" 
                                  Variant="Variant.Outlined"
                                  Dense="true"
                                  Style="min-width: 150px;">
                            <MudSelectItem Value="satellite">Satellite</MudSelectItem>
                            <MudSelectItem Value="terrain">Terrain</MudSelectItem>
                            <MudSelectItem Value="roadmap">Roadmap</MudSelectItem>
                        </MudSelect>
                        <MudIconButton Icon="@Icons.Material.Filled.Layers" 
                                      Size="Size.Small"
                                      OnClick="@ToggleLayers" />
                        <MudIconButton Icon="@Icons.Material.Filled.Fullscreen" 
                                      Size="Size.Small"
                                      OnClick="@ToggleFullscreen" />
                    </MudStack>
                }
            </MudStack>

            @if (_isLoading)
            {
                <MudProgressLinear Indeterminate="true" />
                <MudText Typo="Typo.body2" Color="Color.Secondary" Align="Align.Center">
                    Loading map data...
                </MudText>
            }
            else if (FieldData != null)
            {
                <MudPaper Elevation="1" Class="pa-4" Style="min-height: 500px; background: var(--mud-palette-background); position: relative;">
                    <div class="field-map-container" style="width: 100%; height: 500px; position: relative;">
                        <!-- Map would be rendered here using a mapping library like Leaflet or Google Maps -->
                        <MudText Typo="Typo.body2" Color="Color.Secondary" Align="Align.Center" Style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
                            Interactive Field Map - Implementation needed
                        </MudText>
                        
                        @if (Wells != null && Wells.Any())
                        {
                            <MudList Dense="true" Style="position: absolute; top: 10px; right: 10px; background: white; max-width: 300px; max-height: 400px; overflow-y: auto;">
                                <MudText Typo="Typo.subtitle2" Class="pa-2">Wells (@Wells.Count)</MudText>
                                @foreach (var well in Wells)
                                {
                                    <MudListItem>
                                        <MudStack Spacing="1">
                                            <MudText Typo="Typo.body2">@well.Name</MudText>
                                            <MudText Typo="Typo.caption" Color="Color.Secondary">@well.Status</MudText>
                                        </MudStack>
                                    </MudListItem>
                                }
                            </MudList>
                        }
                    </div>
                </MudPaper>
            }
            else
            {
                <MudText Typo="Typo.body2" Color="Color.Secondary" Align="Align.Center">
                    No field data available
                </MudText>
            }
        </MudStack>
    </MudCardContent>
</MudCard>

@code {
    [Parameter] public string Title { get; set; } = "Field Map";
    [Parameter] public object? FieldData { get; set; }
    [Parameter] public List<WellMarker>? Wells { get; set; }
    [Parameter] public bool ShowControls { get; set; } = true;
    [Parameter] public int Elevation { get; set; } = 2;
    [Parameter] public string? Class { get; set; }

    private string _mapType = "satellite";
    private bool _isLoading = false;
    private bool _isFullscreen = false;
    private bool _showLayers = true;

    private void ToggleLayers()
    {
        _showLayers = !_showLayers;
        StateHasChanged();
    }

    private void ToggleFullscreen()
    {
        _isFullscreen = !_isFullscreen;
        StateHasChanged();
    }

    public class WellMarker
    {
        public string Id { get; set; } = string.Empty;
        public string Name { get; set; } = string.Empty;
        public string Status { get; set; } = string.Empty;
        public double Latitude { get; set; }
        public double Longitude { get; set; }
    }
}

<style>
    .field-map {
        height: 100%;
    }

    .field-map-container {
        border: 1px solid var(--mud-palette-divider);
        border-radius: 4px;
    }
</style>

