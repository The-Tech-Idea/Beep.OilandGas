@page "/register"
@layout AccountLayout
@inject NavigationManager NavigationManager
@inject Beep.OilandGas.Web.Theme.IThemeProvider ThemeProvider
@inject ISnackbar Snackbar
@using Beep.OilandGas.Web.Theme

<PageTitle>Register - Beep Oil & Gas</PageTitle>

<MudContainer MaxWidth="MaxWidth.Small" Class="py-12">
    <MudPaper Elevation="3" Class="pa-8">
        <MudStack Spacing="4" AlignItems="AlignItems.Center">
            <img src="/imgs/BeepOGDM.png" alt="Beep Oil & Gas" style="height: 60px; width: auto; margin-bottom: 16px;" />
            <MudText Typo="Typo.h4">@(_branding.RegisterTitle ?? "Create Account")</MudText>
            <MudText Typo="Typo.body2" Align="Align.Center" Style="color: var(--mud-palette-text-secondary);">
                @(_branding.RegisterSubtitle ?? "Register to get started with Beep Oil & Gas")
            </MudText>
            
            <MudProgressCircular Indeterminate="true" Size="Size.Large" Class="mt-8" />
            <MudText Typo="Typo.body2" Align="Align.Center" Style="color: var(--mud-palette-text-secondary);">
                Redirecting to registration...
            </MudText>
        </MudStack>
    </MudPaper>
</MudContainer>

@code {
    private BrandingConfig _branding = new();

    protected override void OnInitialized()
    {
        _branding = ThemeProvider.GetBranding();
    }
    
    protected override async Task OnInitializedAsync()
    {
        // Redirect to IdentityServer registration with client_id
        var returnUrl = NavigationManager.Uri.Contains("returnUrl") 
            ? NavigationManager.Uri.Split("returnUrl=")[1] 
            : "/dashboard";
        
        // IdentityServer handles registration at /account/register
        // Include client_id so IdentityServer can apply the correct branding
        var identityServerUrl = "https://localhost:7062/account/register";
        NavigationManager.NavigateTo($"{identityServerUrl}?returnUrl={Uri.EscapeDataString(returnUrl)}&client_id=beep_oilgas_web", forceLoad: true);
    }
}

