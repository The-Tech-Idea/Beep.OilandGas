@page "/ppdm39/stratigraphy/units"
@using Beep.OilandGas.PPDM39.Models
@inject ApiClient ApiClient
@inject ISnackbar Snackbar

<PageTitle>Stratigraphic Units - PPDM39</PageTitle>

<MudContainer MaxWidth="MaxWidth.ExtraLarge">
    <MudText Typo="Typo.h4" Class="mb-4">Stratigraphic Units</MudText>
    
    <MudPaper Class="pa-4">
        @if (_isLoading)
        {
            <MudProgressLinear Color="Color.Primary" Indeterminate="true" Class="my-4" />
        }
        
        @if (_units != null && _units.Any())
        {
            <MudTable Items="@_units" Hover="true" Dense="true">
                <HeaderContent>
                    <MudTh>Unit ID</MudTh>
                    <MudTh>Unit Name</MudTh>
                    <MudTh>Active</MudTh>
                    <MudTh>Actions</MudTh>
                </HeaderContent>
                <RowTemplate>
                    <MudTd DataLabel="Unit ID">@context.STRAT_UNIT_ID</MudTd>
                    <MudTd DataLabel="Unit Name">@(!string.IsNullOrWhiteSpace(context.SHORT_NAME) ? context.SHORT_NAME : !string.IsNullOrWhiteSpace(context.LONG_NAME) ? context.LONG_NAME : context.STRAT_UNIT_ID ?? "N/A")</MudTd>
                    <MudTd DataLabel="Active">
                        <MudChip T="string" Color="@(context.ACTIVE_IND == "Y" ? Color.Success : Color.Default)" Size="Size.Small">
                            @context.ACTIVE_IND
                        </MudChip>
                    </MudTd>
                    <MudTd DataLabel="Actions">
                        <MudIconButton Icon="@Icons.Material.Filled.Edit" Size="Size.Small" Color="Color.Primary" />
                    </MudTd>
                </RowTemplate>
            </MudTable>
        }
    </MudPaper>
</MudContainer>

@code {
    private List<STRAT_UNIT>? _units;
    private bool _isLoading = false;

    protected override async Task OnInitializedAsync()
    {
        await LoadUnits();
    }

    private async Task LoadUnits()
    {
        _isLoading = true;
        try
        {
            _units = await ApiClient.GetAsync<List<STRAT_UNIT>>("/api/stratigraphy/units");
        }
        catch (Exception ex)
        {
            Snackbar.Add($"Error loading units: {ex.Message}", Severity.Error);
        }
        finally
        {
            _isLoading = false;
        }
    }

    private string GetPropertyValue(STRAT_UNIT unit, string propertyName)
    {
        var prop = unit.GetType().GetProperty(propertyName);
        return prop?.GetValue(unit)?.ToString() ?? "N/A";
    }
}

