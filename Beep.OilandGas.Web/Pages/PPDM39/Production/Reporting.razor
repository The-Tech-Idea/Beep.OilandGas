@page "/ppdm39/production/reporting"
@using Beep.OilandGas.PPDM39.Models
@inject ApiClient ApiClient
@inject ISnackbar Snackbar

<PageTitle>Production Reporting - PPDM39</PageTitle>

<MudContainer MaxWidth="MaxWidth.ExtraLarge">
    <MudText Typo="Typo.h4" Class="mb-4">Production Reporting</MudText>
    
    <MudPaper Class="pa-4">
        @if (_isLoading)
        {
            <MudProgressLinear Color="Color.Primary" Indeterminate="true" Class="my-4" />
        }
        
        @if (_reporting != null && _reporting.Any())
        {
            <MudTable Items="@_reporting" Hover="true" Dense="true">
                <HeaderContent>
                    <MudTh>Report ID</MudTh>
                    <MudTh>Report Date</MudTh>
                </HeaderContent>
                <RowTemplate>
                    <MudTd DataLabel="Report ID">@GetPropertyValue(context, "REPORT_ID")</MudTd>
                    <MudTd DataLabel="Report Date">@GetPropertyValue(context, "REPORT_DATE")</MudTd>
                </RowTemplate>
            </MudTable>
        }
    </MudPaper>
</MudContainer>

@code {
    private List<PDEN_VOL_SUMMARY>? _reporting;
    private bool _isLoading = false;

    protected override async Task OnInitializedAsync()
    {
        await LoadReporting();
    }

    private async Task LoadReporting()
    {
        _isLoading = true;
        try
        {
            _reporting = await ApiClient.GetAsync<List<PDEN_VOL_SUMMARY>>("/api/production/reporting");
        }
        catch (Exception ex)
        {
            Snackbar.Add($"Error loading production reporting: {ex.Message}", Severity.Error);
        }
        finally
        {
            _isLoading = false;
        }
    }

    private string GetPropertyValue(object obj, string propertyName)
    {
        if (obj is IDictionary<string, object> dict && dict.ContainsKey(propertyName))
        {
            return dict[propertyName]?.ToString() ?? "N/A";
        }
        var prop = obj.GetType().GetProperty(propertyName);
        return prop?.GetValue(obj)?.ToString() ?? "N/A";
    }

    private string FormatDate(string? dateStr)
    {
        if (string.IsNullOrEmpty(dateStr) || dateStr == "N/A")
            return "N/A";

        if (DateTime.TryParse(dateStr, out var date))
            return date.ToString("yyyy-MM-dd");

        return dateStr;
    }
}



